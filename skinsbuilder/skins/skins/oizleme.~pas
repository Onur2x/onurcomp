unit oizleme;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms,
   StdCtrls, ExtCtrls, panelresim,resim,SkinIniFiles;

type
  TForm2 = class(TForm)
    ana: TResimPanel;
    transparent: TLabel;
    secili: TLabel;
    sayi: TLabel;
    o1: TResimPanel;
    o2: TResimPanel;
    o3: TResimPanel;
    o4: TResimPanel;
    o5: TResimPanel;
    o6: TResimPanel;
    o7: TResimPanel;
    o8: TResimPanel;
    o9: TResimPanel;
    o10: TResimPanel;
    o11: TResimPanel;
    o12: TResimPanel;
    o13: TResimPanel;
    o14: TResimPanel;
    procedure DosyaOku(DosyaAdi:string);
    procedure LoadFromStream(Stream: TStream);
    procedure LoadObjectFromStrings(Images: TList; SkinObject: Tresimpanel;
  ObjectName: string; Data: TscCustomIniFile);

    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;
   p:String;
  imagem:TksBmp;
   i: byte;
   FImages: TList;
  FObjects: TList;
   const
Sign = 'MoonAndStar Skin Dosyasý';
Suyari='Lütfen Bu Dosyada Hiç Bir Deðiþiklik Uygulamayýn Aksi Halde Skin Dosyasýný Çalýþtýramazsýnýz';
sImagesSection= 'Resimler';
RE='onur.Msd';

implementation

uses Unit1;

{$R *.dfm}

function izal(var S: string): string;
var
  i: byte;
  CopyS: string;
begin
  Result := '';
  CopyS := S;
  for i := 1 to Length(CopyS) do
  begin
    Delete(S, 1, 1);
    if CopyS[i] in [',', ' ', '(', ')', ';'] then Break;
    Result := Result + CopyS[i];
  end;
  Trim(Result);
  Trim(S);
end;
function ExtractTileStyle(S: string):TStil;
begin
  Result := ortala;
  if LowerCase(S) = 'Ortala' then Result := Ortala;
  if LowerCase(S) = 'Normal' then Result := Normal;
  if LowerCase(S) = 'Döþe' then Result := dose;
end;

function ExtractColor(S: string): TColor; // extract color from 0,0,0 string
var
  R, G, B: byte;
begin
  R := StrToInt(izal(S));
  G := StrToInt(izal(S));
  B := StrToInt(izal(S));
  Result := RGB(R, G, B);
end;

function GetImage(Images: TList; Name: string): TksBmp;
var
  i: integer;
begin
  for i := 0 to Images.Count-1 do
    if LowerCase(TksBmp(Images[i]).Name) = LowerCase(Name) then
    begin
      Result := Images[i];
      Exit;
    end;
  Result := nil;
end;
function ExtractImage(SourceImage: TksBmp; S: string): TksBmp;
var
  R: TRect;
  str: string;
begin
 if S = '' then
  begin
    Result := SourceImage.GetCopy;
  end
  else
  begin
    // Load rectangle
    try
      R := Rect(0, 0, SourceImage.Width, SourceImage.Height);
      str := izal(S);
      if str <> '' then R.left := StrToInt(str);
      str := izal(S);
      if str <> '' then R.top := StrToInt(str);
      str := izal(S);
      if str <> '' then R.right := StrToInt(str);
      str := izal(S);
      if str <> '' then R.bottom := StrToInt(str);

      Result := TksBmp.Create(R.right-R.left+1, R.bottom-R.top+1);
      SourceImage.CopyRect1(Result, R, 0, 0);
      Result.Rect := R;
    except
    end;
  end;
  end;
  procedure TForm2.LoadFromStream(Stream: TStream);
var
  SkinObject: TResimPanel;
  SkinImage: TksBmp;
  SkinFile: TscStringsIniFile;
  Str: TStrings;
  i: integer;
  l,S: String;
begin
//SkinFile := TscStringsIniFile.Create;
//Str := TStringList.Create;
//try
//SkinFile.LoadFromStream(Stream);
//SkinFile.ReadSectionValues(sImagesSection, Str);
for i := 0 to 13 do
// begin
//SkinImage := TksBmp.CreateFromStream(Stream);
//SkinImage.Name := Str.Names[i];
//FImages.Add(SkinImage);
//LoadObjectFromStrings(FImages, (FindComponent('o'+inttostr(i+1))as TResimPanel),'', SkinFile);
(FindComponent('o'+inttostr(i+1))as TResimPanel).Resim.Bitmap.LoadFromStream(stream);
//end;

//    finally
//      Str.Free;
   // SkinFile.Free;

  end;
//end;
procedure Tform2.LoadObjectFromStrings(Images: TList; SkinObject: Tresimpanel;
  ObjectName: string; Data: TscCustomIniFile);
var
  S, Word: string;
  Obj: TResimPanel;
  image,TempImage: TksBmp;
begin
  with SkinObject do
  begin
 //   Name := ObjectName;
 ObjectName:=name;
    S := Data.ReadString(ObjectName, 'Resim', '');

    S := Data.ReadString(ObjectName, 'Sol', '');
    if S <> '' then    Left := StrToInt(S);

    S := Data.ReadString(ObjectName, 'üst', '');
    if S <> '' then       Top := StrToInt(S);
    S := Data.ReadString(ObjectName, 'Geniþlik', '');
    if S <> '' then Width := StrToInt(S);
    S := Data.ReadString(ObjectName, 'Yükseklik', '');
    if S <> '' then Height := StrToInt(S);
    S := Data.ReadString(ObjectName, 'Resim Düzeni', '');
    if S <> '' then Stili := ExtractTileStyle(S);
    S := Data.ReadString(ObjectName, 'Color', '');
    if S <> '' then Color := ExtractColor(S);
     { Extract image }
    end;
    { Extract origin and size }

 end;

procedure Tform2.DosyaOku(DosyaAdi:string);
var
packfile:Tstream;
begin
 PackFile := TFileStream.Create(dosyaadi, fmOpenRead);
  try
LoadFromStream(packfile);
  finally
  PackFile.Free;
 end;
end;

procedure TForm2.FormCreate(Sender: TObject);
begin
DosyaOku(p+re);
end;

end.
